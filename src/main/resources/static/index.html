<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<link href="/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<script src="/jquery-1.8.3.min.js"></script>
<title>WSQ Viewer</title>
<style>
    body{
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    }
    .left-side{
        border-right: 4px solid #eee;
    }
    .right{
        float: right;
    }
    .img-box{
        padding-top: 5%;
        min-height: 500px;
    }
</style>
</head>
<body>
<div class="container">
<div class="row">
    <div class="col-md-1"></div>
    <div class="col-md-5 left-side">
        <label class="right">Select WSQ file</label>
        <input id="wsq1" class="form-control input-right" type="file" name="wsq">

        <form id="wsq-form1" action="/process" method="post">
            <fieldset class="form-group">
                <input type="hidden" id="data1" name="wsq" value="">
            </fieldset>
            <button id="btn1" class="btn btn-primary right">View WSQ</button>
        </form>
        <div id="jpg1" class="right img-box"></div>
    </div>
    <div class="col-md-5">
        <label>Select WSQ file</label>
        <input id="wsq2" class="form-control" type="file" name="wsq">

        <form id="wsq-form2" action="/process" method="post">
            <fieldset class="form-group">
                <input type="hidden" id="data2" name="wsq" value="">
            </fieldset>
            <button id="btn2" class="btn btn-primary">View WSQ</button>
        </form>
        <div id="jpg2" class="img-box"></div>
    </div>
    <div class="col-md-1"></div>
</div>
</div>
<script>
    $("#btn1").click({form: '#wsq-form1', view: "#jpg1"}, uploadFiles);
    $("#btn2").click({form: '#wsq-form2', view: "#jpg2"}, uploadFiles);
    var files, blob;
    $('#wsq1').on('change', {dataNode: '#data1'}, prepareUpload);
    $('#wsq2').on('change', {dataNode: '#data2'}, prepareUpload);

    function prepareUpload(event) {
        files = event.target.files;
        var fr = new FileReader();
        if (FileReader && files && files.length) {
            fr.readAsBinaryString(files[0]);
            fr.onload = function () {
                blob = fr.result;
                $(event.data.dataNode).val(btoa(blob));
            };
        }
    }

    function uploadFiles(event) {

        event.stopPropagation();
        event.preventDefault();

        var formData = $(event.data.form).serialize();
        $.post("/process", formData, function (data) {
            if (data != "ERROR") {
                var $img = $("<img/>");
                $img.attr("src", "data:image/jpg;base64," + data);
                $img.addClass("card card-block");
                $(event.data.view).html($img);
            } else {
                $(event.data.view).html('<span class="alert-danger card card-block">Error while processing WSQ</span>');
            }
        }, "json");
    }

</script>
</body>
</html>